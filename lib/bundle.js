!function(t,e){if("object"==typeof exports&&"object"==typeof module)module.exports=e();else if("function"==typeof define&&define.amd)define([],e);else{var n=e();for(var r in n)("object"==typeof exports?exports:t)[r]=n[r]}}(this,function(){return function(t){function e(r){if(n[r])return n[r].exports;var a=n[r]={i:r,l:!1,exports:{}};return t[r].call(a.exports,a,a.exports,e),a.l=!0,a.exports}var n={};return e.m=t,e.c=n,e.i=function(t){return t},e.d=function(t,n,r){e.o(t,n)||Object.defineProperty(t,n,{configurable:!1,enumerable:!0,get:r})},e.n=function(t){var n=t&&t.__esModule?function(){return t.default}:function(){return t};return e.d(n,"a",n),n},e.o=function(t,e){return Object.prototype.hasOwnProperty.call(t,e)},e.p="",e(e.s=4)}([function(t,e,n){function r(t){n(11)}var a=n(1)(n(5),n(9),r,null,null);t.exports=a.exports},function(t,e){t.exports=function(t,e,n,r,a){var i,o=t=t||{},s=typeof t.default;"object"!==s&&"function"!==s||(i=t,o=t.default);var c="function"==typeof o?o.options:o;e&&(c.render=e.render,c.staticRenderFns=e.staticRenderFns),r&&(c._scopeId=r);var u;if(a?(u=function(t){t=t||this.$vnode&&this.$vnode.ssrContext||this.parent&&this.parent.$vnode&&this.parent.$vnode.ssrContext,t||"undefined"==typeof __VUE_SSR_CONTEXT__||(t=__VUE_SSR_CONTEXT__),n&&n.call(this,t),t&&t._registeredComponents&&t._registeredComponents.add(a)},c._ssrRegister=u):n&&(u=n),u){var h=c.functional,d=h?c.render:c.beforeCreate;h?c.render=function(t,e){return u.call(e),d(t,e)}:c.beforeCreate=d?[].concat(d,u):[u]}return{esModule:i,exports:o,options:c}}},function(t,e,n){var r=n(1)(n(6),n(10),null,null,null);t.exports=r.exports},function(t,e){t.exports=function(t){if(!t.webpackPolyfill){var e=Object.create(t);e.children||(e.children=[]),Object.defineProperty(e,"loaded",{enumerable:!0,get:function(){return e.l}}),Object.defineProperty(e,"id",{enumerable:!0,get:function(){return e.i}}),Object.defineProperty(e,"exports",{enumerable:!0}),e.webpackPolyfill=1}return e}},function(t,e,n){"use strict";Object.defineProperty(e,"__esModule",{value:!0}),function(t){var e=n(0),r=n.n(e),a=n(2),i=n.n(a),o={VueAvatar:r.a,VueAvatarEditor:i.a};t.exports=o,t.exports.default=o}.call(e,n(3)(t))},function(t,e,n){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var r=function(){function t(t,e){var n=[],r=!0,a=!1,i=void 0;try{for(var o,s=t[Symbol.iterator]();!(r=(o=s.next()).done)&&(n.push(o.value),!e||n.length!==e);r=!0);}catch(t){a=!0,i=t}finally{try{!r&&s.return&&s.return()}finally{if(a)throw i}}return n}return function(e,n){if(Array.isArray(e))return e;if(Symbol.iterator in Object(e))return t(e,n);throw new TypeError("Invalid attempt to destructure non-iterable instance")}}();e.default={props:{image:{type:String,default:""},border:{type:Number,default:25},borderRadius:{type:Number,default:0},width:{type:Number,default:200},height:{type:Number,default:200},color:{type:Array,default:function(){return[0,0,0,.5]}},scale:{type:Number,default:1},rotation:{type:Number,default:0}},data:function(){return{cursor:"cursorPointer",canvas:null,context:null,dragged:!1,imageLoaded:!1,changed:!1,state:{drag:!1,my:null,mx:null,xxx:"ab",image:{x:0,y:0,resource:null}}}},computed:{canvasWidth:function(){return this.getDimensions().canvas.width},canvasHeight:function(){return this.getDimensions().canvas.height},rotationRadian:function(){return this.rotation*Math.PI/180}},mounted:function(){var t=this;if(this.canvas=this.$refs.avatarEditorCanvas,this.context=this.canvas.getContext("2d"),this.paint(),this.image)this.loadImage(this.image);else{var e=this.svgToImage('<svg id="Layer_1" data-name="Layer 1" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 65 65"><defs><style>.cls-1{fill:#000;}</style></defs><title>Upload_Upload</title><path class="cls-1" d="M32.5,1A31.5,31.5,0,1,1,1,32.5,31.54,31.54,0,0,1,32.5,1m0-1A32.5,32.5,0,1,0,65,32.5,32.5,32.5,0,0,0,32.5,0h0Z"/><polygon class="cls-1" points="41.91 28.2 32.59 18.65 23.09 28.39 24.17 29.44 31.87 21.54 31.87 40.05 33.37 40.05 33.37 21.59 40.83 29.25 41.91 28.2"/><polygon class="cls-1" points="40.66 40.35 40.66 44.35 24.34 44.35 24.34 40.35 22.34 40.35 22.34 44.35 22.34 46.35 24.34 46.35 40.66 46.35 42.66 46.35 42.66 44.35 42.66 40.35 40.66 40.35"/></svg>');e.onload=function(){var n=t.canvasWidth/2-this.width/2,r=t.canvasHeight/2-this.height/2;t.context.drawImage(e,n,r,this.width,this.height)}}},methods:{drawRoundedRect:function(t,e,n,r,a,i){if(0===i)t.rect(e,n,r,a);else{var o=r-i,s=a-i;t.translate(e,n),t.arc(i,i,i,Math.PI,1.5*Math.PI),t.lineTo(o,0),t.arc(o,i,i,1.5*Math.PI,2*Math.PI),t.lineTo(r,s),t.arc(o,s,i,2*Math.PI,.5*Math.PI),t.lineTo(i,a),t.arc(i,s,i,.5*Math.PI,Math.PI),t.translate(-e,-n)}},svgToImage:function(t){var e=new Blob([t],{type:"image/svg+xml;charset=utf-8"}),n=self.URL||self.webkitURL||self,r=n.createObjectURL(e),a=new Image;return a.src=r,a},setState:function(t){var e=Math.ceil(1),n=Math.floor(1e4);this.state=t,this.state.cnt="HELLO"+Math.floor(Math.random()*(n-e))+e},paint:function(){this.context.save(),this.context.translate(0,0),this.context.fillStyle="rgba("+this.color.slice(0,4).join(",")+")";var t=this.borderRadius,e=this.getDimensions(),n=e.border,r=e.canvas.height,a=e.canvas.width;t=Math.max(t,0),t=Math.min(t,a/2-n,r/2-n),this.context.beginPath(),this.drawRoundedRect(this.context,n,n,a-2*n,r-2*n,t),this.context.rect(a,0,-a,r),this.context.fill("evenodd"),this.context.restore()},getDimensions:function(){return{width:this.width,height:this.height,border:this.border,canvas:{width:this.width+2*this.border,height:this.height+2*this.border}}},onDrop:function(t){var e=this;if(t=t||window.event,t.stopPropagation(),t.preventDefault(),t.dataTransfer&&t.dataTransfer.files.length){var n=new FileReader,r=t.dataTransfer.files[0];this.changed=!0,n.onload=function(t){return e.loadImage(t.target.result)},n.readAsDataURL(r)}},onDragStart:function(t){var e=this;t=t||window.event,t.preventDefault(),this.state.drag=!0,this.state.mx=null,this.state.my=null,this.cursor="cursorGrabbing";var n=document,r=!1,a=function a(o){e.onDragEnd(o),!r&&o.targetTouches&&t.target.click(),n.removeEventListener("mouseup",a),n.removeEventListener("mousemove",i),n.removeEventListener("touchend",a),n.removeEventListener("touchmove",i)},i=function(t){r=!0,e.onMouseMove(t)};n.addEventListener("mouseup",a),n.addEventListener("mousemove",i),n.addEventListener("touchend",a),n.addEventListener("touchmove",i)},onDragEnd:function(t){this.state.drag&&(this.state.drag=!1,this.cursor="cursorPointer")},onMouseMove:function(t){if(t=t||window.event,!1!==this.state.drag){this.dragged=!0,this.changed=!0;var e=this.state.image,n=e.x,r=e.y,a=t.targetTouches?t.targetTouches[0].pageX:t.clientX,i=t.targetTouches?t.targetTouches[0].pageY:t.clientY,o={mx:a,my:i,image:e};if(this.state.mx&&this.state.my){var s=(this.state.mx-a)/this.scale,c=(this.state.my-i)/this.scale;e.y=this.getBoundedY(r-c,this.scale),e.x=this.getBoundedX(n-s,this.scale)}this.state.mx=o.mx,this.state.my=o.my,this.state.image=e}},replaceImageInBounds:function(){var t=this.state.image;t.y=this.getBoundedY(t.y,this.scale),t.x=this.getBoundedX(t.x,this.scale)},loadImage:function(t){var e=new Image,n=this;e.onload=function(){var t=n.getInitialSize(e.width,e.height);n.state.image.x=0,n.state.image.y=0,n.state.image.resource=e,n.state.image.width=t.width,n.state.image.height=t.height,n.state.drag=!1,n.$emit("vue-avatar-editor:image-ready",n.scale),n.imageLoaded=!0,n.cursor="cursorGrab"},e.onerror=function(t){return console.log("error loading image: ",t)},this.isDataURL(t)||(e.crossOrigin="anonymous"),e.src=t},getInitialSize:function(t,e){var n=void 0,r=void 0,a=this.getDimensions();return a.height/a.width>e/t?(n=this.getDimensions().height,r=t*(n/e)):(r=this.getDimensions().width,n=e*(r/t)),{height:n,width:r}},isDataURL:function(t){return null!==t&&!!t.match(/^\s*data:([a-z]+\/[a-z]+(;[a-z\-]+=[a-z\-]+)?)?(;base64)?,[a-z0-9!$&',()*+;=\-._~:@\/?%\s]*\s*$/i)},getBoundedX:function(t,e){var n=this.state.image,r=this.getDimensions(),a=Math.abs(n.width*Math.cos(this.rotationRadian))+Math.abs(n.height*Math.sin(this.rotationRadian)),i=Math.floor((a-r.width/e)/2);return i=Math.max(0,i),Math.max(-i,Math.min(t,i))},getBoundedY:function(t,e){var n=this.state.image,r=this.getDimensions(),a=Math.abs(n.width*Math.sin(this.rotationRadian))+Math.abs(n.height*Math.cos(this.rotationRadian)),i=Math.floor((a-r.height/e)/2);return i=Math.max(0,i),Math.max(-i,Math.min(t,i))},paintImage:function(t,e,n){if(e.resource){var r=this.calculatePosition(e,n);t.save(),t.globalCompositeOperation="destination-over";var a=this.getDimensions();t.translate(a.canvas.width/2,a.canvas.height/2),t.rotate(this.rotationRadian),t.translate(-a.canvas.width/2,-a.canvas.height/2),t.drawImage(e.resource,r.x,r.y,r.width,r.height),t.restore()}},transformDataWithRotation:function(t,e){var n=-this.rotationRadian;return[t*Math.cos(n)-e*Math.sin(n),t*Math.sin(n)+e*Math.cos(n)]},calculatePosition:function(t,e){t=t||this.state.image;var n=this.getDimensions(),a=t.width*this.scale,i=t.height*this.scale,o=(a-n.width)/2,s=(i-n.height)/2,c=t.x*this.scale,u=t.y*this.scale,h=this.transformDataWithRotation(c,u),d=r(h,2);return c=d[0],u=d[1],c+=e-o,u+=e-s,{x:c,y:u,height:i,width:a}},redraw:function(){this.context.clearRect(0,0,this.getDimensions().canvas.width,this.getDimensions().canvas.height),this.paint(),this.paintImage(this.context,this.state.image,this.border)},getImage:function(){var t=this.getCroppingRect(),e=this.state.image;t.x*=e.resource.width,t.y*=e.resource.height,t.width*=e.resource.width,t.height*=e.resource.height;var n=document.createElement("canvas");return n.width=t.width,n.height=t.height,n.getContext("2d").drawImage(e.resource,-t.x,-t.y),n},getImageScaled:function(){var t=this.getDimensions(),e=t.width,n=t.height,r=document.createElement("canvas");return r.width=e,r.height=n,this.paintImage(r.getContext("2d"),this.state.image,0),r},imageChanged:function(){return this.changed},getCroppingRect:function(){var t=this.getDimensions(),e={x:t.border,y:t.border,width:t.width,height:t.height},n=this.calculatePosition(this.state.image,t.border);return{x:(e.x-n.x)/n.width,y:(e.y-n.y)/n.height,width:e.width/n.width,height:e.height/n.height}},clicked:function(t){!0===this.dragged?this.dragged=!1:this.$refs.input.click()},fileSelected:function(t){var e=this,n=t.target.files||t.dataTransfer.files;if(n.length){var r=new FileReader;this.changed=!0,r.onload=function(t){return e.loadImage(t.target.result)},r.readAsDataURL(n[0])}}},watch:{state:{handler:function(t,e){this.imageLoaded&&this.redraw()},deep:!0},scale:function(){this.imageLoaded&&(this.replaceImageInBounds(),this.redraw())},rotation:function(){this.imageLoaded&&(this.replaceImageInBounds(),this.redraw())},borderRadius:function(){this.redraw()}}}},function(t,e,n){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var r=n(0),a=n.n(r);e.default={props:{finishText:{type:String,default:"Save"},hasRotation:{type:Boolean,default:!0},hasScale:{type:Boolean,default:!0},image:{type:String,default:""},border:{type:Number,default:25},borderRadius:{type:Number,default:0},width:{type:Number,default:200},height:{type:Number,default:200},color:{type:Array,default:function(){return[0,0,0,.5]}}},data:function(){return{rotation:0,scale:1}},components:{VueAvatar:a.a},methods:{onImageReady:function(){this.scale=1,this.rotation=0},finished:function(){return this.$emit("finished",this.$refs.vueavatar.getImageScaled())}}}},function(t,e,n){e=t.exports=n(8)(!0),e.push([t.i,"canvas{width:300px;height:300px}.cursorPointer{cursor:pointer}.cursorGrab{cursor:grab;cursor:-webkit-grab;cursor:-moz-grab}.cursorGrabbing{cursor:grabbing;cursor:-webkit-grabbing;cursor:-moz-grabbing}","",{version:3,sources:["/home/aurelien/dev/perso/vue-avatar-editor/src/components/VueAvatar.vue"],names:[],mappings:"AACA,OACI,YAAa,AACb,YAAc,CACjB,AACD,eACI,cAAgB,CACnB,AACD,YACI,YAAa,AACb,oBAAqB,AACrB,gBAAkB,CACrB,AACD,gBACI,gBAAiB,AACjB,wBAAyB,AACzB,oBAAsB,CACzB",file:"VueAvatar.vue",sourcesContent:["\ncanvas {\n    width: 300px;\n    height: 300px;\n}\n.cursorPointer{\n    cursor: pointer;\n}\n.cursorGrab{\n    cursor: grab;\n    cursor: -webkit-grab;\n    cursor: -moz-grab;\n}\n.cursorGrabbing{\n    cursor: grabbing;\n    cursor: -webkit-grabbing;\n    cursor: -moz-grabbing;\n}\n"],sourceRoot:""}])},function(t,e){function n(t,e){var n=t[1]||"",a=t[3];if(!a)return n;if(e&&"function"==typeof btoa){var i=r(a);return[n].concat(a.sources.map(function(t){return"/*# sourceURL="+a.sourceRoot+t+" */"})).concat([i]).join("\n")}return[n].join("\n")}function r(t){return"/*# sourceMappingURL=data:application/json;charset=utf-8;base64,"+btoa(unescape(encodeURIComponent(JSON.stringify(t))))+" */"}t.exports=function(t){var e=[];return e.toString=function(){return this.map(function(e){var r=n(e,t);return e[2]?"@media "+e[2]+"{"+r+"}":r}).join("")},e.i=function(t,n){"string"==typeof t&&(t=[[null,t,""]]);for(var r={},a=0;a<this.length;a++){var i=this[a][0];"number"==typeof i&&(r[i]=!0)}for(a=0;a<t.length;a++){var o=t[a];"number"==typeof o[0]&&r[o[0]]||(n&&!o[2]?o[2]=n:n&&(o[2]="("+o[2]+") and ("+n+")"),e.push(o))}},e}},function(t,e){t.exports={render:function(){var t=this,e=t.$createElement,n=t._self._c||e;return n("div",[n("canvas",{ref:"avatarEditorCanvas",staticClass:"cursorPointer",attrs:{width:t.canvasWidth,height:t.canvasHeight,id:"avatarEditorCanvas"},on:{dragover:function(t){t.preventDefault()},drop:t.onDrop,mousedown:t.onDragStart,touchstart:t.onDragStart,click:t.clicked}}),t._v(" "),n("input",{ref:"input",staticStyle:{display:"none"},attrs:{type:"file"},on:{change:t.fileSelected}})])},staticRenderFns:[]}},function(t,e){t.exports={render:function(){var t=this,e=t.$createElement,n=t._self._c||e;return n("div",[n("vue-avatar",{ref:"vueavatar",attrs:{width:t.width,height:t.height,rotation:t.rotation,borderRadius:t.borderRadius,border:t.border,color:t.color,scale:t.scale},on:{"vue-avatar-editor:image-ready":t.onImageReady}}),t._v(" "),n("br"),t._v(" "),t.hasScale?n("label",[t._v("\n    Zoom : "+t._s(t.scale)+"x\n    "),n("br"),t._v(" "),n("input",{directives:[{name:"model",rawName:"v-model",value:t.scale,expression:"scale"}],attrs:{type:"range",min:"1",max:"3",step:"0.02"},domProps:{value:t.scale},on:{__r:function(e){t.scale=e.target.value}}})]):t._e(),t._v(" "),n("br"),t._v(" "),t.hasRotation?n("label",[t._v("\n    Rotation : "+t._s(t.rotation)+"Â°\n    "),n("br"),t._v(" "),n("input",{directives:[{name:"model",rawName:"v-model",value:t.rotation,expression:"rotation"}],attrs:{type:"range",min:"0",max:"360",step:"1"},domProps:{value:t.rotation},on:{__r:function(e){t.rotation=e.target.value}}})]):t._e(),t._v(" "),n("br"),t._v(" "),n("button",{on:{click:t.finished}},[t._v(t._s(t.finishText))])],1)},staticRenderFns:[]}},function(t,e,n){var r=n(7);"string"==typeof r&&(r=[[t.i,r,""]]),r.locals&&(t.exports=r.locals);n(12)("a76f23c4",r,!0)},function(t,e,n){function r(t){for(var e=0;e<t.length;e++){var n=t[e],r=h[n.id];if(r){r.refs++;for(var a=0;a<r.parts.length;a++)r.parts[a](n.parts[a]);for(;a<n.parts.length;a++)r.parts.push(i(n.parts[a]));r.parts.length>n.parts.length&&(r.parts.length=n.parts.length)}else{for(var o=[],a=0;a<n.parts.length;a++)o.push(i(n.parts[a]));h[n.id]={id:n.id,refs:1,parts:o}}}}function a(){var t=document.createElement("style");return t.type="text/css",d.appendChild(t),t}function i(t){var e,n,r=document.querySelector('style[data-vue-ssr-id~="'+t.id+'"]');if(r){if(g)return v;r.parentNode.removeChild(r)}if(m){var i=f++;r=l||(l=a()),e=o.bind(null,r,i,!1),n=o.bind(null,r,i,!0)}else r=a(),e=s.bind(null,r),n=function(){r.parentNode.removeChild(r)};return e(t),function(r){if(r){if(r.css===t.css&&r.media===t.media&&r.sourceMap===t.sourceMap)return;e(t=r)}else n()}}function o(t,e,n,r){var a=n?"":r.css;if(t.styleSheet)t.styleSheet.cssText=p(e,a);else{var i=document.createTextNode(a),o=t.childNodes;o[e]&&t.removeChild(o[e]),o.length?t.insertBefore(i,o[e]):t.appendChild(i)}}function s(t,e){var n=e.css,r=e.media,a=e.sourceMap;if(r&&t.setAttribute("media",r),a&&(n+="\n/*# sourceURL="+a.sources[0]+" */",n+="\n/*# sourceMappingURL=data:application/json;base64,"+btoa(unescape(encodeURIComponent(JSON.stringify(a))))+" */"),t.styleSheet)t.styleSheet.cssText=n;else{for(;t.firstChild;)t.removeChild(t.firstChild);t.appendChild(document.createTextNode(n))}}var c="undefined"!=typeof document;if("undefined"!=typeof DEBUG&&DEBUG&&!c)throw new Error("vue-style-loader cannot be used in a non-browser environment. Use { target: 'node' } in your Webpack config to indicate a server-rendering environment.");var u=n(13),h={},d=c&&(document.head||document.getElementsByTagName("head")[0]),l=null,f=0,g=!1,v=function(){},m="undefined"!=typeof navigator&&/msie [6-9]\b/.test(navigator.userAgent.toLowerCase());t.exports=function(t,e,n){g=n;var a=u(t,e);return r(a),function(e){for(var n=[],i=0;i<a.length;i++){var o=a[i],s=h[o.id];s.refs--,n.push(s)}e?(a=u(t,e),r(a)):a=[];for(var i=0;i<n.length;i++){var s=n[i];if(0===s.refs){for(var c=0;c<s.parts.length;c++)s.parts[c]();delete h[s.id]}}}};var p=function(){var t=[];return function(e,n){return t[e]=n,t.filter(Boolean).join("\n")}}()},function(t,e){t.exports=function(t,e){for(var n=[],r={},a=0;a<e.length;a++){var i=e[a],o=i[0],s=i[1],c=i[2],u=i[3],h={id:t+":"+a,css:s,media:c,sourceMap:u};r[o]?r[o].parts.push(h):n.push(r[o]={id:o,parts:[h]})}return n}}])});
//# sourceMappingURL=bundle.js.map