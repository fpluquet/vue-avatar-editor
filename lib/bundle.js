!function(t,e){if("object"==typeof exports&&"object"==typeof module)module.exports=e();else if("function"==typeof define&&define.amd)define([],e);else{var n=e();for(var a in n)("object"==typeof exports?exports:t)[a]=n[a]}}(this,function(){return function(t){function e(a){if(n[a])return n[a].exports;var r=n[a]={i:a,l:!1,exports:{}};return t[a].call(r.exports,r,r.exports,e),r.l=!0,r.exports}var n={};return e.m=t,e.c=n,e.i=function(t){return t},e.d=function(t,n,a){e.o(t,n)||Object.defineProperty(t,n,{configurable:!1,enumerable:!0,get:a})},e.n=function(t){var n=t&&t.__esModule?function(){return t.default}:function(){return t};return e.d(n,"a",n),n},e.o=function(t,e){return Object.prototype.hasOwnProperty.call(t,e)},e.p="",e(e.s=3)}([function(t,e,n){function a(t){n(10)}var r=n(1)(n(4),n(8),a,null,null);t.exports=r.exports},function(t,e){t.exports=function(t,e,n,a,r){var i,o=t=t||{},s=typeof t.default;"object"!==s&&"function"!==s||(i=t,o=t.default);var h="function"==typeof o?o.options:o;e&&(h.render=e.render,h.staticRenderFns=e.staticRenderFns),a&&(h._scopeId=a);var u;if(r?(u=function(t){t=t||this.$vnode&&this.$vnode.ssrContext||this.parent&&this.parent.$vnode&&this.parent.$vnode.ssrContext,t||"undefined"==typeof __VUE_SSR_CONTEXT__||(t=__VUE_SSR_CONTEXT__),n&&n.call(this,t),t&&t._registeredComponents&&t._registeredComponents.add(r)},h._ssrRegister=u):n&&(u=n),u){var c=h.functional,d=c?h.render:h.beforeCreate;c?h.render=function(t,e){return u.call(e),d(t,e)}:h.beforeCreate=d?[].concat(d,u):[u]}return{esModule:i,exports:o,options:h}}},function(t,e,n){var a=n(1)(n(5),n(9),null,null,null);t.exports=a.exports},function(t,e,n){var a=n(0),r=n(2),i={VueAvatar:a,VueAvatarEditor:r};t.exports=i,t.exports.default=i},function(t,e,n){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var a=function(){function t(t,e){var n=[],a=!0,r=!1,i=void 0;try{for(var o,s=t[Symbol.iterator]();!(a=(o=s.next()).done)&&(n.push(o.value),!e||n.length!==e);a=!0);}catch(t){r=!0,i=t}finally{try{!a&&s.return&&s.return()}finally{if(r)throw i}}return n}return function(e,n){if(Array.isArray(e))return e;if(Symbol.iterator in Object(e))return t(e,n);throw new TypeError("Invalid attempt to destructure non-iterable instance")}}();e.default={props:{image:{type:String,default:""},border:{type:Number,default:25},borderRadius:{type:Number,default:0},width:{type:Number,default:200},height:{type:Number,default:200},color:{type:Array,default:function(){return[0,0,0,.5]}},scale:{type:Number,default:1},rotation:{type:Number,default:0}},data:function(){return{cursor:"cursorPointer",canvas:null,context:null,dragged:!1,imageLoaded:!1,changed:!1,state:{drag:!1,my:null,mx:null,xxx:"ab",image:{x:0,y:0,resource:null}}}},computed:{canvasWidth:function(){return this.getDimensions().canvas.width},canvasHeight:function(){return this.getDimensions().canvas.height},rotationRadian:function(){return this.rotation*Math.PI/180}},mounted:function(){var t=this;if(this.canvas=this.$refs.avatarEditorCanvas,this.context=this.canvas.getContext("2d"),this.paint(),this.image)this.loadImage(this.image);else{var e=this.svgToImage('<svg id="Layer_1" data-name="Layer 1" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 65 65"><defs><style>.cls-1{fill:#000;}</style></defs><title>Upload_Upload</title><path class="cls-1" d="M32.5,1A31.5,31.5,0,1,1,1,32.5,31.54,31.54,0,0,1,32.5,1m0-1A32.5,32.5,0,1,0,65,32.5,32.5,32.5,0,0,0,32.5,0h0Z"/><polygon class="cls-1" points="41.91 28.2 32.59 18.65 23.09 28.39 24.17 29.44 31.87 21.54 31.87 40.05 33.37 40.05 33.37 21.59 40.83 29.25 41.91 28.2"/><polygon class="cls-1" points="40.66 40.35 40.66 44.35 24.34 44.35 24.34 40.35 22.34 40.35 22.34 44.35 22.34 46.35 24.34 46.35 40.66 46.35 42.66 46.35 42.66 44.35 42.66 40.35 40.66 40.35"/></svg>');e.onload=function(){var n=t.canvasWidth/2-this.width/2,a=t.canvasHeight/2-this.height/2;t.context.drawImage(e,n,a,this.width,this.height)}}},methods:{drawRoundedRect:function(t,e,n,a,r,i){if(0===i)t.rect(e,n,a,r);else{var o=a-i,s=r-i;t.translate(e,n),t.arc(i,i,i,Math.PI,1.5*Math.PI),t.lineTo(o,0),t.arc(o,i,i,1.5*Math.PI,2*Math.PI),t.lineTo(a,s),t.arc(o,s,i,2*Math.PI,.5*Math.PI),t.lineTo(i,r),t.arc(i,s,i,.5*Math.PI,Math.PI),t.translate(-e,-n)}},svgToImage:function(t){var e=new Blob([t],{type:"image/svg+xml;charset=utf-8"}),n=self.URL||self.webkitURL||self,a=n.createObjectURL(e),r=new Image;return r.src=a,r},setState:function(t){var e=Math.ceil(1),n=Math.floor(1e4);this.state=t,this.state.cnt="HELLO"+Math.floor(Math.random()*(n-e))+e},paint:function(){this.context.save(),this.context.translate(0,0),this.context.fillStyle="rgba("+this.color.slice(0,4).join(",")+")";var t=this.borderRadius,e=this.getDimensions(),n=e.border,a=e.canvas.height,r=e.canvas.width;t=Math.max(t,0),t=Math.min(t,r/2-n,a/2-n),this.context.beginPath(),this.drawRoundedRect(this.context,n,n,r-2*n,a-2*n,t),this.context.rect(r,0,-r,a),this.context.fill("evenodd"),this.context.restore()},getDimensions:function(){return{width:this.width,height:this.height,border:this.border,canvas:{width:this.width+2*this.border,height:this.height+2*this.border}}},onDrop:function(t){var e=this;if(t=t||window.event,t.stopPropagation(),t.preventDefault(),t.dataTransfer&&t.dataTransfer.files.length){var n=new FileReader,a=t.dataTransfer.files[0];this.changed=!0,n.onload=function(t){return e.loadImage(t.target.result)},n.readAsDataURL(a)}},onDragStart:function(t){var e=this;t=t||window.event,t.preventDefault(),this.state.drag=!0,this.state.mx=null,this.state.my=null,this.cursor="cursorGrabbing";var n=document,a=!1,r=function r(o){e.onDragEnd(o),!a&&o.targetTouches&&t.target.click(),n.removeEventListener("mouseup",r),n.removeEventListener("mousemove",i),n.removeEventListener("touchend",r),n.removeEventListener("touchmove",i)},i=function(t){a=!0,e.onMouseMove(t)};n.addEventListener("mouseup",r),n.addEventListener("mousemove",i),n.addEventListener("touchend",r),n.addEventListener("touchmove",i)},onDragEnd:function(t){this.state.drag&&(this.state.drag=!1,this.cursor="cursorPointer")},onMouseMove:function(t){if(t=t||window.event,!1!==this.state.drag){this.dragged=!0,this.changed=!0;var e=this.state.image,n=e.x,a=e.y,r=t.targetTouches?t.targetTouches[0].pageX:t.clientX,i=t.targetTouches?t.targetTouches[0].pageY:t.clientY,o={mx:r,my:i,image:e};if(this.state.mx&&this.state.my){var s=(this.state.mx-r)/this.scale,h=(this.state.my-i)/this.scale;e.y=this.getBoundedY(a-h,this.scale),e.x=this.getBoundedX(n-s,this.scale)}this.state.mx=o.mx,this.state.my=o.my,this.state.image=e}},replaceImageInBounds:function(){var t=this.state.image;t.y=this.getBoundedY(t.y,this.scale),t.x=this.getBoundedX(t.x,this.scale)},loadImage:function(t){var e=new Image,n=this;e.onload=function(){var t=n.getInitialSize(e.width,e.height);n.state.image.x=0,n.state.image.y=0,n.state.image.resource=e,n.state.image.width=t.width,n.state.image.height=t.height,n.state.drag=!1,n.$emit("vue-avatar-editor:image-ready",n.scale),n.imageLoaded=!0,n.cursor="cursorGrab"},e.onerror=function(t){return console.log("error loading image: ",t)},this.isDataURL(t)||(e.crossOrigin="anonymous"),e.src=t},getInitialSize:function(t,e){var n=void 0,a=void 0,r=this.getDimensions();return r.height/r.width>e/t?(n=this.getDimensions().height,a=t*(n/e)):(a=this.getDimensions().width,n=e*(a/t)),{height:n,width:a}},isDataURL:function(t){return null!==t&&!!t.match(/^\s*data:([a-z]+\/[a-z]+(;[a-z\-]+=[a-z\-]+)?)?(;base64)?,[a-z0-9!$&',()*+;=\-._~:@\/?%\s]*\s*$/i)},getBoundedX:function(t,e){var n=this.state.image,a=this.getDimensions(),r=Math.abs(n.width*Math.cos(this.rotationRadian))+Math.abs(n.height*Math.sin(this.rotationRadian)),i=Math.floor((r-a.width/e)/2);return i=Math.max(0,i),Math.max(-i,Math.min(t,i))},getBoundedY:function(t,e){var n=this.state.image,a=this.getDimensions(),r=Math.abs(n.width*Math.sin(this.rotationRadian))+Math.abs(n.height*Math.cos(this.rotationRadian)),i=Math.floor((r-a.height/e)/2);return i=Math.max(0,i),Math.max(-i,Math.min(t,i))},paintImage:function(t,e,n){if(e.resource){var a=this.calculatePosition(e,n);t.save(),t.globalCompositeOperation="destination-over";var r=this.getDimensions();t.translate(r.canvas.width/2,r.canvas.height/2),t.rotate(this.rotationRadian),t.translate(-r.canvas.width/2,-r.canvas.height/2),t.drawImage(e.resource,a.x,a.y,a.width,a.height),t.restore()}},transformDataWithRotation:function(t,e){var n=-this.rotationRadian;return[t*Math.cos(n)-e*Math.sin(n),t*Math.sin(n)+e*Math.cos(n)]},calculatePosition:function(t,e){t=t||this.state.image;var n=this.getDimensions(),r=t.width*this.scale,i=t.height*this.scale,o=(r-n.width)/2,s=(i-n.height)/2,h=t.x*this.scale,u=t.y*this.scale,c=this.transformDataWithRotation(h,u),d=a(c,2);return h=d[0],u=d[1],h+=e-o,u+=e-s,{x:h,y:u,height:i,width:r}},redraw:function(){this.context.clearRect(0,0,this.getDimensions().canvas.width,this.getDimensions().canvas.height),this.paint(),this.paintImage(this.context,this.state.image,this.border)},getImage:function(){var t=this.getCroppingRect(),e=this.state.image;t.x*=e.resource.width,t.y*=e.resource.height,t.width*=e.resource.width,t.height*=e.resource.height;var n=document.createElement("canvas");return n.width=t.width,n.height=t.height,n.getContext("2d").drawImage(e.resource,-t.x,-t.y),n},getImageScaled:function(){var t=this.getDimensions(),e=t.width,n=t.height,a=document.createElement("canvas");return a.width=e,a.height=n,this.paintImage(a.getContext("2d"),this.state.image,0),a},imageChanged:function(){return this.changed},getCroppingRect:function(){var t=this.getDimensions(),e={x:t.border,y:t.border,width:t.width,height:t.height},n=this.calculatePosition(this.state.image,t.border);return{x:(e.x-n.x)/n.width,y:(e.y-n.y)/n.height,width:e.width/n.width,height:e.height/n.height}},clicked:function(t){!0===this.dragged?this.dragged=!1:this.$refs.input.click()},fileSelected:function(t){var e=this,n=t.target.files||t.dataTransfer.files;if(n.length){var a=new FileReader;this.changed=!0,a.onload=function(t){return e.loadImage(t.target.result)},a.readAsDataURL(n[0])}}},watch:{state:{handler:function(t,e){this.imageLoaded&&this.redraw()},deep:!0},scale:function(){this.imageLoaded&&(this.replaceImageInBounds(),this.redraw())},rotation:function(){this.imageLoaded&&(this.replaceImageInBounds(),this.redraw())},borderRadius:function(){this.redraw()}}}},function(t,e,n){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var a=n(0),r=n.n(a);e.default={props:{finishText:{type:String,default:"Save"},hasRotation:{type:Boolean,default:!0},hasScale:{type:Boolean,default:!0},image:{type:String,default:""},border:{type:Number,default:25},borderRadius:{type:Number,default:0},width:{type:Number,default:200},height:{type:Number,default:200},color:{type:Array,default:function(){return[0,0,0,.5]}}},data:function(){return{rotation:0,scale:1}},components:{VueAvatar:r.a},methods:{onImageReady:function(){this.scale=1,this.rotation=0},finished:function(){return this.$emit("finished",this.$refs.vueavatar.getImageScaled())}}}},function(t,e,n){e=t.exports=n(7)(!0),e.push([t.i,"canvas{width:300px;height:300px}.cursorPointer{cursor:pointer}.cursorGrab{cursor:grab;cursor:-webkit-grab;cursor:-moz-grab}.cursorGrabbing{cursor:grabbing;cursor:-webkit-grabbing;cursor:-moz-grabbing}","",{version:3,sources:["/home/aurelien/dev/perso/vue-avatar-editor/src/components/VueAvatar.vue"],names:[],mappings:"AACA,OACI,YAAa,AACb,YAAc,CACjB,AACD,eACI,cAAgB,CACnB,AACD,YACI,YAAa,AACb,oBAAqB,AACrB,gBAAkB,CACrB,AACD,gBACI,gBAAiB,AACjB,wBAAyB,AACzB,oBAAsB,CACzB",file:"VueAvatar.vue",sourcesContent:["\ncanvas {\n    width: 300px;\n    height: 300px;\n}\n.cursorPointer{\n    cursor: pointer;\n}\n.cursorGrab{\n    cursor: grab;\n    cursor: -webkit-grab;\n    cursor: -moz-grab;\n}\n.cursorGrabbing{\n    cursor: grabbing;\n    cursor: -webkit-grabbing;\n    cursor: -moz-grabbing;\n}\n"],sourceRoot:""}])},function(t,e){function n(t,e){var n=t[1]||"",r=t[3];if(!r)return n;if(e&&"function"==typeof btoa){var i=a(r);return[n].concat(r.sources.map(function(t){return"/*# sourceURL="+r.sourceRoot+t+" */"})).concat([i]).join("\n")}return[n].join("\n")}function a(t){return"/*# sourceMappingURL=data:application/json;charset=utf-8;base64,"+btoa(unescape(encodeURIComponent(JSON.stringify(t))))+" */"}t.exports=function(t){var e=[];return e.toString=function(){return this.map(function(e){var a=n(e,t);return e[2]?"@media "+e[2]+"{"+a+"}":a}).join("")},e.i=function(t,n){"string"==typeof t&&(t=[[null,t,""]]);for(var a={},r=0;r<this.length;r++){var i=this[r][0];"number"==typeof i&&(a[i]=!0)}for(r=0;r<t.length;r++){var o=t[r];"number"==typeof o[0]&&a[o[0]]||(n&&!o[2]?o[2]=n:n&&(o[2]="("+o[2]+") and ("+n+")"),e.push(o))}},e}},function(t,e){t.exports={render:function(){var t=this,e=t.$createElement,n=t._self._c||e;return n("div",[n("canvas",{ref:"avatarEditorCanvas",staticClass:"cursorPointer",attrs:{width:t.canvasWidth,height:t.canvasHeight,id:"avatarEditorCanvas"},on:{dragover:function(t){t.preventDefault()},drop:t.onDrop,mousedown:t.onDragStart,touchstart:t.onDragStart,click:t.clicked}}),t._v(" "),n("input",{ref:"input",staticStyle:{display:"none"},attrs:{type:"file"},on:{change:t.fileSelected}})])},staticRenderFns:[]}},function(t,e){t.exports={render:function(){var t=this,e=t.$createElement,n=t._self._c||e;return n("div",[n("vue-avatar",{ref:"vueavatar",attrs:{width:t.width,height:t.height,rotation:t.rotation,borderRadius:t.borderRadius,border:t.border,color:t.color,scale:t.scale},on:{"vue-avatar-editor:image-ready":t.onImageReady}}),t._v(" "),n("br"),t._v(" "),t.hasScale?n("label",[t._v("\n    Zoom : "+t._s(t.scale)+"x\n    "),n("br"),t._v(" "),n("input",{directives:[{name:"model",rawName:"v-model",value:t.scale,expression:"scale"}],attrs:{type:"range",min:"1",max:"3",step:"0.02"},domProps:{value:t.scale},on:{__r:function(e){t.scale=e.target.value}}})]):t._e(),t._v(" "),n("br"),t._v(" "),t.hasRotation?n("label",[t._v("\n    Rotation : "+t._s(t.rotation)+"Â°\n    "),n("br"),t._v(" "),n("input",{directives:[{name:"model",rawName:"v-model",value:t.rotation,expression:"rotation"}],attrs:{type:"range",min:"0",max:"360",step:"1"},domProps:{value:t.rotation},on:{__r:function(e){t.rotation=e.target.value}}})]):t._e(),t._v(" "),n("br"),t._v(" "),n("button",{on:{click:t.finished}},[t._v(t._s(t.finishText))])],1)},staticRenderFns:[]}},function(t,e,n){var a=n(6);"string"==typeof a&&(a=[[t.i,a,""]]),a.locals&&(t.exports=a.locals);n(11)("a76f23c4",a,!0)},function(t,e,n){function a(t){for(var e=0;e<t.length;e++){var n=t[e],a=c[n.id];if(a){a.refs++;for(var r=0;r<a.parts.length;r++)a.parts[r](n.parts[r]);for(;r<n.parts.length;r++)a.parts.push(i(n.parts[r]));a.parts.length>n.parts.length&&(a.parts.length=n.parts.length)}else{for(var o=[],r=0;r<n.parts.length;r++)o.push(i(n.parts[r]));c[n.id]={id:n.id,refs:1,parts:o}}}}function r(){var t=document.createElement("style");return t.type="text/css",d.appendChild(t),t}function i(t){var e,n,a=document.querySelector('style[data-vue-ssr-id~="'+t.id+'"]');if(a){if(f)return v;a.parentNode.removeChild(a)}if(m){var i=g++;a=l||(l=r()),e=o.bind(null,a,i,!1),n=o.bind(null,a,i,!0)}else a=r(),e=s.bind(null,a),n=function(){a.parentNode.removeChild(a)};return e(t),function(a){if(a){if(a.css===t.css&&a.media===t.media&&a.sourceMap===t.sourceMap)return;e(t=a)}else n()}}function o(t,e,n,a){var r=n?"":a.css;if(t.styleSheet)t.styleSheet.cssText=p(e,r);else{var i=document.createTextNode(r),o=t.childNodes;o[e]&&t.removeChild(o[e]),o.length?t.insertBefore(i,o[e]):t.appendChild(i)}}function s(t,e){var n=e.css,a=e.media,r=e.sourceMap;if(a&&t.setAttribute("media",a),r&&(n+="\n/*# sourceURL="+r.sources[0]+" */",n+="\n/*# sourceMappingURL=data:application/json;base64,"+btoa(unescape(encodeURIComponent(JSON.stringify(r))))+" */"),t.styleSheet)t.styleSheet.cssText=n;else{for(;t.firstChild;)t.removeChild(t.firstChild);t.appendChild(document.createTextNode(n))}}var h="undefined"!=typeof document;if("undefined"!=typeof DEBUG&&DEBUG&&!h)throw new Error("vue-style-loader cannot be used in a non-browser environment. Use { target: 'node' } in your Webpack config to indicate a server-rendering environment.");var u=n(12),c={},d=h&&(document.head||document.getElementsByTagName("head")[0]),l=null,g=0,f=!1,v=function(){},m="undefined"!=typeof navigator&&/msie [6-9]\b/.test(navigator.userAgent.toLowerCase());t.exports=function(t,e,n){f=n;var r=u(t,e);return a(r),function(e){for(var n=[],i=0;i<r.length;i++){var o=r[i],s=c[o.id];s.refs--,n.push(s)}e?(r=u(t,e),a(r)):r=[];for(var i=0;i<n.length;i++){var s=n[i];if(0===s.refs){for(var h=0;h<s.parts.length;h++)s.parts[h]();delete c[s.id]}}}};var p=function(){var t=[];return function(e,n){return t[e]=n,t.filter(Boolean).join("\n")}}()},function(t,e){t.exports=function(t,e){for(var n=[],a={},r=0;r<e.length;r++){var i=e[r],o=i[0],s=i[1],h=i[2],u=i[3],c={id:t+":"+r,css:s,media:h,sourceMap:u};a[o]?a[o].parts.push(c):n.push(a[o]={id:o,parts:[c]})}return n}}])});
//# sourceMappingURL=bundle.js.map